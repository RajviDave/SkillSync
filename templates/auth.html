<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skill Sync | Authentication</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="center">
  <div class="card">
    <h2>Welcome to <span style="color: #f58092;">SkillSync</span></h2>
    <p style="color: #555; margin: 15px 0 30px; font-size: 14px;">
      Sign in to continue or create a new account
    </p>

    <!-- Email Login Form -->
    <form id="emailLoginForm" style="display: none;">
      <input type="email" id="loginEmail" placeholder="Email address" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <button type="submit">Sign In</button>
      <p style="margin-top: 15px; font-size: 12px; color: #666;">
        Don't have an account? <a href="#" onclick="showSignup(); return false;" style="color: #818cf8; cursor: pointer;">Sign Up</a>
      </p>
    </form>

    <!-- Email Signup Form -->
    <form id="emailSignupForm" style="display: none;">
      <input type="text" id="signupName" placeholder="Full Name" required />
      <input type="email" id="signupEmail" placeholder="Email address" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <button type="submit">Sign Up</button>
      <p style="margin-top: 15px; font-size: 12px; color: #666;">
        Already have an account? <a href="#" onclick="showLogin(); return false;" style="color: #818cf8; cursor: pointer;">Sign In</a>
      </p>
    </form>

    <!-- Toggle Buttons -->
    <div id="authToggle" style="margin-bottom: 20px;">
      <button onclick="showLogin()" style="width: 48%; margin-right: 4%;">Sign In</button>
      <button onclick="showSignup()" style="width: 48%;" class="outline">Sign Up</button>
    </div>

    <div class="divider">OR</div>

    <!-- Google Sign In -->
    <div id="g_id_onload"
         data-client_id="615991134229-koia6quigiedb5vh0hcs7trik6o6l1ej.apps.googleusercontent.com"
         data-callback="handleGoogleLogin"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular"></div>

    <div id="errorMessage" style="color: #f58092; margin-top: 15px; font-size: 12px; display: none;"></div>
  </div>

  <script>
    // Show login form by default
    showLogin();

    function showLogin() {
      document.getElementById('emailLoginForm').style.display = 'block';
      document.getElementById('emailSignupForm').style.display = 'none';
      document.getElementById('authToggle').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'none';
    }

    function showSignup() {
      document.getElementById('emailSignupForm').style.display = 'block';
      document.getElementById('emailLoginForm').style.display = 'none';
      document.getElementById('authToggle').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'none';
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    // Handle Email Login
    document.getElementById('emailLoginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      const formData = new FormData();
      formData.append('email', email);
      formData.append('password', password);

      fetch('backend/login.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          // Redirect to main evaluation page
          window.location.href = '/main';
        } else {
          showError(data.message || 'Login failed');
        }
      })
      .catch(err => {
        showError('Network error. Please try again.');
        console.error(err);
      });
    });

    // Handle Email Signup
    document.getElementById('emailSignupForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;

      const formData = new FormData();
      formData.append('name', name);
      formData.append('email', email);
      formData.append('password', password);

      fetch('backend/signup.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          // Redirect to main evaluation page
          window.location.href = '/main';
        } else {
          showError(data.message || 'Signup failed');
        }
      })
      .catch(err => {
        showError('Network error. Please try again.');
        console.error(err);
      });
    });

    // Handle Google Login
    function handleGoogleLogin(response) {
      const formData = new FormData();
      formData.append('token', response.credential);

      fetch('backend/google_login.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          // Redirect to main evaluation page
          window.location.href = '/main';
        } else {
          showError(data.message || 'Google login failed');
        }
      })
      .catch(err => {
        showError('Network error. Please try again.');
        console.error(err);
      });
    }
  </script>
</body>
</html>
